version: "3"

services:
  chrome:
    image: selenium/standalone-chrome
    ports:
      - "4444:4444"
    shm_size: '1gb'

  scrapper:
    build:
      context: .
    depends_on:
      - chrome
      - redis
      - worker
    volumes:
      - /api
    ports:
      - "5000:5000"

  nginx:
      image: nginx:latest
      volumes:
        - ./nginx.conf:/etc/nginx/nginx.conf:ro
      depends_on:
        - scrapper
      ports:
        - "6127:6127"

  redis:
    image: redis
    ports:
      - "6378:6378"

  worker:
    build:
      context: .
    command: celery -A tasks.celery worker --loglevel=info
    depends_on:
      - redis

     

    